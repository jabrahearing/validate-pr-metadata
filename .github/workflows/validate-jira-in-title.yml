name: PR Title JIRA Check

on:
  pull_request:
    types: 
      - opened
      - reopened
      - ready_for_review
      - edited
      - synchronize
  merge_group:
    types: [checks_requested]

jobs:
  validate-pr-title:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR title
        run: |
          title_regex='^\[(([^[:space:]]+\-[0-9]+)(,[[:space:]]*))*([^[:space:]]+\-[0-9]+)\].+'
          if [[ "${{ github.event.pull_request.title }}" =~ $title_regex ]]; then
            echo "PR title matches expected format"
          else
            echo "PR title does not match expected format."
            echo "Format is \`[JIRAPROJECT-DIGITS] Message\` e.g. [JES-1234] Fix snyk. "
            echo "The title was: ${{ github.event.pull_request.title }}"
            exit 1
          fi
